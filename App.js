
Action: {"type": "mcp_tool", "tool_name": "mcp_bulk_file_writer", "tool_arguments": {"files": [{"content": "import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { \n  Plus, \n  Pencil, \n  Trash2, \n  MessageCircle, \n  Save,\n  X,\n  Smartphone,\n  User,\n  ExternalLink,\n  Copy,\n  Check\n} from 'lucide-react';\nimport { Toaster, toast } from 'sonner';\n\n// Configure Axios\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8001';\nconst API = axios.create({\n  baseURL: `${BACKEND_URL}/api`\n});\n\n// --- Components ---\n\nconst SplashScreen = ({ onFinish }) => {\n  const [isVisible, setIsVisible] = useState(true);\n  const [opacity, setOpacity] = useState(1);\n\n  useEffect(() => {\n    // Start fade out after 0.8s\n    const timer1 = setTimeout(() => {\n      setOpacity(0);\n    }, 800);\n\n    // Remove from DOM after fade out completes (e.g. 0.2s transition)\n    const timer2 = setTimeout(() => {\n      setIsVisible(false);\n      onFinish();\n    }, 1000);\n\n    return () => {\n      clearTimeout(timer1);\n      clearTimeout(timer2);\n    };\n  }, [onFinish]);\n\n  if (!isVisible) return null;\n\n  return (\n    <div \n      className=\"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white transition-opacity duration-500 ease-out\"\n      style={{ opacity: opacity }}\n    >\n      <div className=\"text-center space-y-2 animate-in zoom-in-95 duration-500\">\n        <h1 className=\"text-4xl md:text-6xl font-extrabold tracking-widest text-orange-500\">\n          SISTEMA DE ENV\u00cdOS\n        </h1>\n        <p className=\"text-sm text-gray-400 font-medium tracking-widest uppercase\">\n          By: bnj\n        </p>\n      </div>\n    </div>\n  );\n};\n\nconst Button = ({ children, variant = 'primary', size = 'default', className = '', ...props }) => {\n  const variants = {\n    primary: 'bg-orange-500 hover:bg-orange-600 text-white shadow-md',\n    secondary: 'bg-white hover:bg-gray-50 text-gray-700 border border-gray-200',\n    ghost: 'hover:bg-gray-100 text-gray-600',\n    destructive: 'bg-red-50 text-red-600 hover:bg-red-100',\n    outline: 'border-2 border-orange-500 text-orange-500 hover:bg-orange-50',\n    success: 'bg-green-500 text-white shadow-md hover:bg-green-600'\n  };\n  \n  const sizes = {\n    sm: 'px-3 py-1.5 text-sm',\n    default: 'px-4 py-2',\n    lg: 'px-6 py-3 text-lg',\n    icon: 'p-2'\n  };\n\n  return (\n    <button \n      className={`\n        inline-flex items-center justify-center gap-2 rounded-lg font-medium transition-all duration-200 ease-out active:scale-95 disabled:opacity-50 disabled:pointer-events-none hover:scale-[1.02]\n        ${variants[variant]} \n        ${sizes[size]} \n        ${className}\n      `}\n      {...props}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst Input = ({ className = '', ...props }) => (\n  <input \n    className={`\n      flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-shadow\n      ${className}\n    `}\n    {...props}\n  />\n);\n\nconst Label = ({ children, className = '', ...props }) => (\n  <label \n    className={`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${className}`}\n    {...props}\n  >\n    {children}\n  </label>\n);\n\nconst Card = ({ children, className = '' }) => (\n  <div className={`\n    rounded-2xl border border-gray-200 bg-white text-gray-950 shadow-sm transition-all duration-300 ease-out \n    hover:-translate-y-1 hover:shadow-xl\n    ${className}\n  `}>\n    {children}\n  </div>\n);\n\nconst Dialog = ({ isOpen, onClose, title, children }) => {\n  if (!isOpen) return null;\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200\">\n      <div className=\"relative w-full max-w-lg rounded-xl bg-white p-6 shadow-2xl animate-in zoom-in-95 duration-200\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-semibold\">{title}</h3>\n          <button onClick={onClose} className=\"rounded-full p-1 hover:bg-gray-100 hover:scale-110 transition-transform\">\n            <X className=\"h-4 w-4\" />\n          </button>\n        </div>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nconst TemplateCard = ({ template, executiveName, clientNumber, onEdit, onDelete }) => {\n  const [propertyLink, setPropertyLink] = useState('');\n  const [isCopied, setIsCopied] = useState(false);\n  \n  // Helper to generate final text\n  const getFinalText = () => {\n    let finalText = template.content.replace(/\\[Nombre_Ejecutivo\\]/g, executiveName);\n    if (template.content.includes('[Input_Para_Link_Propiedad]')) {\n        // If empty, just leave placeholder for copy/preview, but warn on send\n        finalText = finalText.replace(/\\[Input_Para_Link_Propiedad\\]/g, propertyLink || '[Link Propiedad]');\n    }\n    return finalText;\n  };\n\n  const handleSendWhatsApp = () => {\n    if (!clientNumber) {\n      toast.error('Por favor ingresa el n\u00famero del cliente primero');\n      return;\n    }\n\n    if (template.content.includes('[Input_Para_Link_Propiedad]') && !propertyLink) {\n        toast.error('Por favor ingresa el link de la propiedad');\n        return;\n    }\n    \n    // Smart Number Logic\n    const rawNumber = clientNumber.trim();\n    const startsWithPlus = rawNumber.startsWith('+');\n    let cleanDigits = rawNumber.replace(/\\D/g, ''); // Remove everything except digits\n    \n    let finalNumber = cleanDigits;\n    \n    if (!startsWithPlus) {\n        // If NO starts with +, prepend 56\n        finalNumber = '56' + cleanDigits;\n    }\n    // If starts with +, respect it (use cleanDigits which already stripped the + but keeps the country code digits)\n    \n    const text = getFinalText();\n    const url = `https://wa.me/${finalNumber}?text=${encodeURIComponent(text)}`;\n    window.open(url, '_blank');\n  };\n\n  const handleCopy = async () => {\n    if (template.content.includes('[Input_Para_Link_Propiedad]') && !propertyLink) {\n        toast.error('Por favor ingresa el link de la propiedad para copiar el mensaje completo');\n        return;\n    }\n    const text = getFinalText();\n    try {\n      await navigator.clipboard.writeText(text);\n      setIsCopied(true);\n      setTimeout(() => setIsCopied(false), 2000);\n      toast.success('Mensaje copiado al portapapeles');\n    } catch (err) {\n      toast.error('Error al copiar');\n    }\n  };\n\n  const needsPropertyLink = template.content.includes('[Input_Para_Link_Propiedad]');\n\n  return (\n    <Card className=\"flex flex-col h-full overflow-hidden group border-l-4 border-l-orange-500\">\n      <div className=\"p-6 flex-1 space-y-4\">\n        <div className=\"flex items-start justify-between\">\n          <h3 className=\"font-bold text-lg text-gray-900 line-clamp-1\" title={template.title}>\n            {template.title}\n          </h3>\n          <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300\">\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => onEdit(template)} className=\"h-8 w-8 hover:bg-orange-100 hover:text-orange-600\">\n              <Pencil className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" onClick={() => onDelete(template.id)} className=\"h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50\">\n              <Trash2 className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n        \n        <div className=\"bg-gray-50 p-4 rounded-xl text-sm text-gray-600 leading-relaxed min-h-[100px] whitespace-pre-wrap border border-gray-100 shadow-inner\">\n          {template.content.split(/(\\[Input_Para_Link_Propiedad\\])/g).map((part, i) => (\n            part === '[Input_Para_Link_Propiedad]' ? (\n              <span key={i} className=\"text-orange-600 font-bold bg-orange-100/50 px-1 rounded mx-1\">\n                {propertyLink || '[Link Propiedad]'}\n              </span>\n            ) : (\n              <span key={i}>{part.replace(/\\[Nombre_Ejecutivo\\]/g, executiveName || '[Nombre]')}</span>\n            )\n          ))}\n        </div>\n\n        {needsPropertyLink && (\n          <div className=\"space-y-1.5 animate-in fade-in slide-in-from-top-2\">\n            <Label className=\"text-xs text-gray-500 uppercase tracking-wider font-bold\">Link Propiedad</Label>\n            <div className=\"relative group/input\">\n              <ExternalLink className=\"absolute left-3 top-2.5 h-4 w-4 text-gray-400 group-focus-within/input:text-orange-500 transition-colors\" />\n              <Input \n                value={propertyLink}\n                onChange={(e) => setPropertyLink(e.target.value)}\n                placeholder=\"Pegar enlace aqu\u00ed...\"\n                className=\"pl-9 bg-orange-50/30 border-orange-100 focus:border-orange-500 transition-all\"\n              />\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className=\"p-4 bg-gray-50 border-t border-gray-100 grid grid-cols-1 gap-3\">\n        <Button onClick={handleSendWhatsApp} className=\"w-full shadow-orange-200/50 hover:shadow-orange-300/50\">\n          <MessageCircle className=\"h-4 w-4 mr-2\" />\n          Enviar por WhatsApp\n        </Button>\n        <Button \n            variant={isCopied ? \"success\" : \"secondary\"} \n            onClick={handleCopy} \n            className=\"w-full transition-all duration-300\"\n        >\n          {isCopied ? (\n            <>\n                <Check className=\"h-4 w-4 mr-2\" />\n                \u00a1Copiado!\n            </>\n          ) : (\n            <>\n                <Copy className=\"h-4 w-4 mr-2\" />\n                Copiar texto\n            </>\n          )}\n        </Button>\n      </div>\n    </Card>\n  );\n};\n\nfunction App() {\n  // State\n  // Default value \"Benjam\u00edn Llancapan\" if not in localStorage\n  const [executiveName, setExecutiveName] = useState(() => localStorage.getItem('executiveName') || 'Benjam\u00edn Llancapan');\n  const [clientNumber, setClientNumber] = useState('');\n  const [templates, setTemplates] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [showContent, setShowContent] = useState(false);\n  \n  // Modal State\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [currentTemplate, setCurrentTemplate] = useState(null); \n  const [formData, setFormData] = useState({ title: '', category: 'Correos', content: '' });\n\n  // Fetch Templates\n  const fetchTemplates = async () => {\n    try {\n      const res = await API.get('/templates');\n      setTemplates(res.data);\n    } catch (error) {\n      console.error('Error fetching templates:', error);\n      toast.error('Error al cargar plantillas');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchTemplates();\n  }, []);\n\n  useEffect(() => {\n    localStorage.setItem('executiveName', executiveName);\n  }, [executiveName]);\n\n  // CRUD Handlers\n  const handleDelete = async (id) => {\n    if (window.confirm('\u00bfEst\u00e1s seguro de eliminar esta plantilla?')) {\n      try {\n        await API.delete(`/templates/${id}`);\n        toast.success('Plantilla eliminada');\n        fetchTemplates();\n      } catch (error) {\n        toast.error('Error al eliminar');\n      }\n    }\n  };\n\n  const handleEdit = (template) => {\n    setCurrentTemplate(template);\n    setFormData({ \n      title: template.title, \n      category: template.category, \n      content: template.content \n    });\n    setIsModalOpen(true);\n  };\n\n  const handleCreate = () => {\n    setCurrentTemplate(null);\n    setFormData({ title: '', category: 'Correos', content: '' });\n    setIsModalOpen(true);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      if (currentTemplate) {\n        await API.put(`/templates/${currentTemplate.id}`, formData);\n        toast.success('Plantilla actualizada');\n      } else {\n        await API.post('/templates', formData);\n        toast.success('Plantilla creada');\n      }\n      setIsModalOpen(false);\n      fetchTemplates();\n    } catch (error) {\n      toast.error('Error al guardar');\n    }\n  };\n\n  // Group Templates\n  const groupedTemplates = {\n    'Respuesta Leads Correos': templates.filter(t => t.category === 'Correos'),\n    'Llamadas que no Contestaron': templates.filter(t => t.category === 'Llamadas'),\n    'Otros': templates.filter(t => !['Correos', 'Llamadas'].includes(t.category))\n  };\n\n  return (\n    <>\n      <SplashScreen onFinish={() => setShowContent(true)} />\n      \n      {showContent && (\n        <div className=\"min-h-screen bg-[#F8FAFC] font-sans text-gray-900 flex flex-col animate-in fade-in duration-1000\">\n          <Toaster position=\"top-right\" richColors />\n          \n          {/* Header */}\n          <header className=\"bg-white border-b border-gray-100 sticky top-0 z-30 shadow-sm backdrop-blur-md bg-white/90\">\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-24 flex items-center justify-between\">\n              <div className=\"flex items-center gap-6\">\n                <img \n                  src=\"https://customer-assets.emergentagent.com/job_real-estate-crm-app/artifacts/5k6bllh3_Captura%20de%20pantalla%202026-02-23%20a%20la%28s%29%2015.46.27.png\" \n                  alt=\"Logo Santamar\u00eda\" \n                  className=\"h-16 w-auto object-contain\"\n                />\n                <div className=\"h-10 w-px bg-gray-200 hidden sm:block\"></div>\n                <h1 className=\"text-xl font-bold text-gray-800 tracking-tight hidden sm:block\">\n                  Sistema de Env\u00edos\n                </h1>\n              </div>\n              \n              <Button onClick={handleCreate} size=\"sm\" variant=\"outline\" className=\"hidden sm:flex rounded-full\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Nueva Plantilla\n              </Button>\n            </div>\n          </header>\n\n          <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-12 flex-grow\">\n            \n            {/* Global Inputs Section */}\n            <section className=\"bg-white rounded-3xl shadow-sm border border-gray-100 p-8 md:p-10 relative overflow-hidden group hover:shadow-lg transition-shadow duration-500\">\n              <div className=\"absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-orange-400 via-orange-500 to-orange-600\"></div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-10 relative z-10\">\n                <div className=\"space-y-4\">\n                  <Label className=\"text-gray-500 uppercase tracking-widest text-xs font-bold flex items-center gap-2\">\n                    <User className=\"h-4 w-4 text-orange-500\" />\n                    Nombre del Ejecutivo\n                  </Label>\n                  <Input \n                    placeholder=\"Ej. Benjam\u00edn Llancapan\" \n                    value={executiveName}\n                    onChange={(e) => setExecutiveName(e.target.value)}\n                    className=\"text-xl py-6 border-0 border-b-2 border-gray-200 rounded-none px-0 focus:ring-0 focus:border-orange-500 bg-transparent placeholder:text-gray-300 transition-colors font-medium\"\n                  />\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <Label className=\"text-gray-500 uppercase tracking-widest text-xs font-bold flex items-center gap-2\">\n                    <Smartphone className=\"h-4 w-4 text-orange-500\" />\n                    Celular del Cliente\n                  </Label>\n                  <Input \n                    type=\"text\" \n                    placeholder=\"Ej. +56 9 1234 5678 o 912345678\" \n                    value={clientNumber}\n                    onChange={(e) => setClientNumber(e.target.value)}\n                    className=\"text-xl py-6 border-0 border-b-2 border-gray-200 rounded-none px-0 focus:ring-0 focus:border-orange-500 bg-transparent placeholder:text-gray-300 transition-colors font-mono font-medium\"\n                  />\n                  <p className=\"text-xs text-orange-600/80 font-medium\">\n                    * Si no comienza con \"+\", se antepondr\u00e1 \"56\" autom\u00e1ticamente.\n                  </p>\n                </div>\n              </div>\n            </section>\n\n            {/* Templates Grid */}\n            {loading ? (\n              <div className=\"flex justify-center py-20\">\n                 <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500\"></div>\n              </div>\n            ) : (\n              <div className=\"space-y-16\">\n                {Object.entries(groupedTemplates).map(([category, items]) => (\n                  items.length > 0 && (\n                    <div key={category} className=\"space-y-6\">\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"h-8 w-1.5 bg-orange-500 rounded-full\"></div>\n                        <h2 className=\"text-2xl font-bold text-gray-800\">{category}</h2>\n                      </div>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                        {items.map(template => (\n                          <TemplateCard \n                            key={template.id} \n                            template={template} \n                            executiveName={executiveName}\n                            clientNumber={clientNumber}\n                            onEdit={handleEdit}\n                            onDelete={handleDelete}\n                          />\n                        ))}\n                      </div>\n                    </div>\n                  )\n                ))}\n              </div>\n            )}\n\n            {/* Floating Action Button for Mobile */}\n            <button \n              onClick={handleCreate}\n              className=\"fixed bottom-24 right-6 h-14 w-14 bg-orange-500 text-white rounded-full shadow-orange-500/30 shadow-2xl flex items-center justify-center sm:hidden active:scale-95 transition-transform z-40 hover:scale-110\"\n            >\n              <Plus className=\"h-6 w-6\" />\n            </button>\n          </main>\n\n          {/* Footer */}\n          <footer className=\"py-8 text-center\">\n            <p className=\"text-xs text-gray-300 font-medium tracking-widest\">\n              by: Bnj\n            </p>\n          </footer>\n\n          {/* Edit/Create Modal */}\n          <Dialog \n            isOpen={isModalOpen} \n            onClose={() => setIsModalOpen(false)} \n            title={currentTemplate ? 'Editar Plantilla' : 'Nueva Plantilla'}\n          >\n            <form onSubmit={handleSubmit} className=\"space-y-5\">\n              <div className=\"space-y-2\">\n                <Label>T\u00edtulo</Label>\n                <Input \n                  required\n                  value={formData.title}\n                  onChange={(e) => setFormData({...formData, title: e.target.value})}\n                  placeholder=\"Ej. Saludo Inicial\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label>Categor\u00eda</Label>\n                <select \n                  className=\"flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-500 transition-shadow\"\n                  value={formData.category}\n                  onChange={(e) => setFormData({...formData, category: e.target.value})}\n                >\n                  <option value=\"Correos\">Correos</option>\n                  <option value=\"Llamadas\">Llamadas</option>\n                  <option value=\"Otros\">Otros</option>\n                </select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Mensaje</Label>\n                <div className=\"text-xs text-gray-500 mb-2 p-3 bg-orange-50/50 rounded-lg border border-orange-100\">\n                  Variables: <span className=\"font-mono text-orange-600 font-bold\">[Nombre_Ejecutivo]</span>, <span className=\"font-mono text-orange-600 font-bold\">[Input_Para_Link_Propiedad]</span>\n                </div>\n                <textarea \n                  required\n                  className=\"flex min-h-[120px] w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-500 transition-shadow resize-y\"\n                  value={formData.content}\n                  onChange={(e) => setFormData({...formData, content: e.target.value})}\n                  placeholder=\"Escribe tu mensaje aqu\u00ed...\"\n                />\n              </div>\n\n              <div className=\"flex justify-end gap-3 pt-4\">\n                <Button type=\"button\" variant=\"secondary\" onClick={() => setIsModalOpen(false)}>\n                  Cancelar\n                </Button>\n                <Button type=\"submit\">\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  Guardar\n                </Button>\n              </div>\n            </form>\n          </Dialog>\n        </div>\n      )}\n    </>\n  );\n}\n\nexport default App;\n", "path": "/app/frontend/src/App.js"}], "status": true}}
Observation: Successfully wrote 1 files:
- /app/frontend/src/App.js

supervisorctl status frontend backend (after restart)

frontend                         RUNNING   pid 1425, uptime 0:00:02
backend                          RUNNING   pid 1451, uptime 0:00:01
